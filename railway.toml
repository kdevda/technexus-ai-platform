[build]
builder = "nixpacks"
buildCommand = "cd client && npm install && npm run build && mkdir -p ../server/public && cp -r dist/* ../server/public/ && cd ../server && npm install && npm run build"
watchPatterns = ["server/**/*", "client/**/*"]

[deploy]
startCommand = "cd server && npx prisma migrate deploy && node dist/index.js"
healthcheckPath = "/api/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"

[env]
NODE_ENV = "production"
PORT = "8000" 